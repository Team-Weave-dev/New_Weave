/**
 * 세무 지식 베이스
 * 한국 세무 관련 지식 데이터
 */

export interface TaxKnowledgeItem {
  id: string;
  category: TaxCategory;
  title: string;
  content: string;
  keywords: string[];
  relatedTopics?: string[];
  effectiveDate?: string;
  expiryDate?: string;
  source?: string;
  examples?: string[];
  warnings?: string[];
  lastUpdated: string;
}

export type TaxCategory = 
  | '소득세'
  | '법인세'
  | '부가가치세'
  | '종합소득세'
  | '원천징수'
  | '4대보험'
  | '세액공제'
  | '절세전략'
  | '세무신고'
  | '세무조사';

/**
 * 세무 지식 데이터베이스
 */
export const taxKnowledgeDB: TaxKnowledgeItem[] = [
  {
    id: 'tk_001',
    category: '종합소득세',
    title: '개인사업자 종합소득세 신고 가이드',
    content: `개인사업자의 종합소득세는 매년 5월 1일부터 5월 31일까지 신고해야 합니다.

신고 대상:
- 사업소득이 있는 개인사업자
- 근로소득과 사업소득이 함께 있는 경우
- 기타소득이 300만원을 초과하는 경우

필요 서류:
1. 종합소득세 신고서
2. 재무제표(손익계산서, 재무상태표)
3. 원천징수영수증
4. 소득공제 증빙서류
5. 세액공제 증빙서류

신고 방법:
- 홈택스 전자신고
- 세무대리인을 통한 신고
- 세무서 방문 신고`,
    keywords: ['종합소득세', '개인사업자', '5월신고', '소득세신고'],
    relatedTopics: ['세액공제', '소득공제', '사업소득'],
    examples: [
      '연매출 1억원 개인사업자의 경우, 간편장부 대상자로 기준경비율 적용 가능',
      '신용카드 사용액의 15~40% 소득공제 가능'
    ],
    warnings: [
      '신고 기한을 놓치면 무신고 가산세 20% 부과',
      '장부 미비치 시 무기장 가산세 부과 가능'
    ],
    lastUpdated: '2024-01-15'
  },
  {
    id: 'tk_002',
    category: '부가가치세',
    title: '부가가치세 신고 및 납부',
    content: `부가가치세는 분기별로 신고하며, 일반과세자와 간이과세자의 신고 주기가 다릅니다.

일반과세자:
- 1기 예정: 1.1~3.31 (4.25까지 신고)
- 1기 확정: 1.1~6.30 (7.25까지 신고)
- 2기 예정: 7.1~9.30 (10.25까지 신고)
- 2기 확정: 7.1~12.31 (다음해 1.25까지 신고)

간이과세자:
- 1.1~12.31 (다음해 1.25까지 신고)

세율:
- 일반세율: 10%
- 영세율: 0% (수출 등)

매입세액공제:
- 사업과 관련된 매입세액은 공제 가능
- 접대비, 개인적 사용 목적은 불공제`,
    keywords: ['부가가치세', 'VAT', '매입세액', '매출세액', '세금계산서'],
    relatedTopics: ['전자세금계산서', '영세율', '간이과세'],
    examples: [
      '매출 1,100만원(VAT 포함) = 매출액 1,000만원 + 부가세 100만원',
      '매입세액 50만원, 매출세액 100만원 → 납부세액 50만원'
    ],
    warnings: [
      '세금계산서 미발급 시 공급가액의 2% 가산세',
      '신고불성실 가산세는 납부세액의 10~40%'
    ],
    lastUpdated: '2024-02-01'
  },
  {
    id: 'tk_003',
    category: '세액공제',
    title: '개인사업자가 받을 수 있는 세액공제',
    content: `개인사업자가 활용할 수 있는 주요 세액공제 항목들입니다.

주요 세액공제:
1. 신용카드 등 소득공제
   - 총급여의 25% 초과 사용액의 15~40%
   - 전통시장 40%, 대중교통 40%, 일반 15%

2. 연금계좌 세액공제
   - 연 700만원 한도
   - 총급여 5,500만원 이하: 16.5%
   - 총급여 5,500만원 초과: 13.2%

3. 보험료 세액공제
   - 보장성보험: 연 100만원 한도, 12%
   - 장애인전용보험: 연 100만원 한도, 15%

4. 의료비 세액공제
   - 총급여의 3% 초과액의 15%
   - 난임시술비: 30%
   - 미숙아·선천성이상아: 20%

5. 교육비 세액공제
   - 본인: 전액, 15%
   - 자녀: 유치원~고등학생 300만원, 대학생 900만원 한도`,
    keywords: ['세액공제', '소득공제', '연말정산', '절세'],
    relatedTopics: ['종합소득세', '근로소득', '사업소득'],
    examples: [
      '연봉 5,000만원, 신용카드 2,000만원 사용 → 187.5만원 소득공제',
      '연금저축 400만원 납입 → 66만원 세액공제 (16.5%)'
    ],
    warnings: [
      '증빙서류 미제출 시 공제 불가',
      '허위 공제 신청 시 가산세 부과'
    ],
    lastUpdated: '2024-01-20'
  },
  {
    id: 'tk_004',
    category: '4대보험',
    title: '개인사업자 4대보험 가입 및 보험료',
    content: `개인사업자의 4대보험 가입 의무와 보험료 계산 방법입니다.

1. 국민연금
   - 기준소득월액의 9%
   - 상한: 590만원, 하한: 37만원
   - 본인 전액 부담

2. 건강보험
   - 소득 기준: 보험료부과점수 × 점수당 금액
   - 2024년 기준: 7.09%
   - 장기요양보험: 건강보험료의 12.95%

3. 고용보험 (자영업자 고용보험)
   - 선택 가입
   - 기준보수의 2.0%
   - 실업급여 수급 가능

4. 산재보험
   - 특수형태근로종사자만 의무 가입
   - 일반 개인사업자는 임의 가입
   - 업종별 요율 적용

사업소득 4,000만원 기준 예시:
- 국민연금: 월 30만원
- 건강보험: 월 23.6만원
- 장기요양: 월 3.1만원
합계: 월 56.7만원`,
    keywords: ['4대보험', '국민연금', '건강보험', '고용보험', '산재보험'],
    relatedTopics: ['사회보험', '보험료', '자영업자'],
    examples: [
      '월소득 300만원 → 국민연금 27만원, 건강보험 21.3만원',
      '자영업자 고용보험 가입 시 폐업 후 실업급여 수급 가능'
    ],
    warnings: [
      '국민연금 미납 시 가산금 부과',
      '건강보험료 6개월 이상 체납 시 급여 제한'
    ],
    lastUpdated: '2024-02-10'
  },
  {
    id: 'tk_005',
    category: '원천징수',
    title: '사업자의 원천징수 의무',
    content: `사업자가 급여, 퇴직금, 기타소득 등을 지급할 때 원천징수해야 합니다.

원천징수 대상:
1. 근로소득 (급여, 상여금)
   - 간이세액표에 따라 원천징수
   - 다음달 10일까지 납부

2. 퇴직소득
   - 퇴직소득세율 적용
   - 근속연수 공제 후 과세

3. 사업소득
   - 원천징수 대상 사업소득의 3%
   - 의료업, 약사 등 특정 업종

4. 기타소득
   - 지급액의 20% (필요경비 80% 인정 시 4%)
   - 강연료, 원고료 등

5. 이자·배당소득
   - 이자소득: 14% (지방소득세 포함 15.4%)
   - 배당소득: 14% (지방소득세 포함 15.4%)

원천징수 절차:
1. 소득 지급 시 세금 원천징수
2. 원천징수영수증 발급
3. 다음달 10일까지 세무서 납부
4. 반기별 원천징수이행상황신고`,
    keywords: ['원천징수', '원천세', '급여', '근로소득세'],
    relatedTopics: ['간이세액표', '원천징수영수증', '지급명세서'],
    examples: [
      '월급 300만원 → 원천징수세액 약 15만원 (부양가족 없는 경우)',
      '강연료 100만원 → 기타소득 원천세 4만원 (필요경비 80% 인정)'
    ],
    warnings: [
      '원천징수 누락 시 가산세 10% 부과',
      '지급명세서 미제출 시 지급금액의 2% 가산세'
    ],
    lastUpdated: '2024-01-25'
  },
  {
    id: 'tk_006',
    category: '절세전략',
    title: '개인사업자 합법적 절세 전략',
    content: `개인사업자가 활용할 수 있는 합법적인 절세 방법들입니다.

1. 적격증빙 수취
   - 모든 경비는 세금계산서, 계산서, 신용카드 영수증으로
   - 간이영수증은 건당 3만원 이하만 인정

2. 소득 분산
   - 가족을 직원으로 고용하여 인건비 처리
   - 배우자, 직계존비속 급여 지급

3. 감가상각 활용
   - 차량, 컴퓨터 등 자산의 감가상각비 계상
   - 즉시상각 특례 활용 (중소기업)

4. 접대비 한도 관리
   - 기본금액 1,200만원 + 수입금액별 추가
   - 한도 내에서 전액 비용 인정

5. 퇴직연금 가입
   - 사업소득의 일정 부분을 퇴직연금으로
   - 세액공제 및 퇴직 시 저율 과세

6. 성실신고확인제 활용
   - 성실신고확인 시 의료비·교육비 세액공제
   - 성실신고확인비용 세액공제 (120만원 한도)

7. 중소기업 특별세액감면
   - 소기업: 10~20% 세액감면
   - 업종 및 지역에 따라 차등 적용`,
    keywords: ['절세', '세금절약', '세테크', '합법절세'],
    relatedTopics: ['세액공제', '소득공제', '비용처리'],
    examples: [
      '배우자 월 150만원 급여 → 연 1,800만원 인건비 처리',
      '업무용 차량 5,000만원 → 연간 1,000만원 감가상각비'
    ],
    warnings: [
      '과도한 경비 처리 시 세무조사 대상',
      '가공경비 계상 시 조세포탈죄 적용 가능'
    ],
    lastUpdated: '2024-02-15'
  },
  {
    id: 'tk_007',
    category: '세무조사',
    title: '세무조사 대응 방법',
    content: `세무조사를 받게 되었을 때의 대응 방법과 준비사항입니다.

세무조사 유형:
1. 정기조사: 4~5년 주기로 실시
2. 수시조사: 탈세 제보, 이상 징후 발견 시
3. 전산조사: 전산 분석을 통한 서면 조사
4. 현장확인: 사업장 실태 확인

사전 준비사항:
- 장부 및 증빙서류 정리
- 세금계산서 발급 내역 확인
- 인건비 지급 내역 점검
- 접대비, 복리후생비 증빙 확인
- 재고자산 실사 준비

조사 진행 시 유의사항:
1. 조사 범위와 기간 확인
2. 세무대리인 선임 고려
3. 성실한 자료 제출
4. 조사관과 원만한 관계 유지
5. 이의신청 권리 숙지

조사 종료 후:
- 추징세액 확인 및 납부
- 불복 시 이의신청 (90일 이내)
- 심사청구, 심판청구 가능
- 행정소송 제기 가능`,
    keywords: ['세무조사', '세무검사', '국세청조사', '탈세조사'],
    relatedTopics: ['추징', '가산세', '이의신청'],
    examples: [
      '매출 누락 10% → 추징세액 + 가산세 40% 부과 가능',
      '가공경비 5,000만원 → 추징 + 가산세 + 형사처벌 가능'
    ],
    warnings: [
      '자료 은닉 시 형사처벌 가능',
      '허위 진술 시 가중처벌'
    ],
    lastUpdated: '2024-02-20'
  }
];

/**
 * 세무 지식 검색 클래스
 */
export class TaxKnowledgeSearch {
  /**
   * 키워드로 세무 지식 검색
   */
  searchByKeywords(keywords: string[]): TaxKnowledgeItem[] {
    const normalizedKeywords = keywords.map(k => k.toLowerCase());
    
    return taxKnowledgeDB.filter(item => {
      const itemText = `${item.title} ${item.content} ${item.keywords.join(' ')}`.toLowerCase();
      return normalizedKeywords.some(keyword => itemText.includes(keyword));
    });
  }

  /**
   * 카테고리로 세무 지식 검색
   */
  searchByCategory(category: TaxCategory): TaxKnowledgeItem[] {
    return taxKnowledgeDB.filter(item => item.category === category);
  }

  /**
   * ID로 세무 지식 가져오기
   */
  getById(id: string): TaxKnowledgeItem | undefined {
    return taxKnowledgeDB.find(item => item.id === id);
  }

  /**
   * 관련 주제로 세무 지식 검색
   */
  searchRelatedTopics(topics: string[]): TaxKnowledgeItem[] {
    return taxKnowledgeDB.filter(item => 
      item.relatedTopics?.some(topic => 
        topics.some(t => t.toLowerCase() === topic.toLowerCase())
      )
    );
  }

  /**
   * 전체 카테고리 목록
   */
  getAllCategories(): TaxCategory[] {
    return [...new Set(taxKnowledgeDB.map(item => item.category))];
  }

  /**
   * 세무 달력 (중요 일정)
   */
  getTaxCalendar(): Array<{date: string, title: string, description: string}> {
    return [
      { date: '01-25', title: '부가가치세 확정신고', description: '2기 확정신고 및 납부' },
      { date: '03-10', title: '법인세 신고', description: '12월 결산법인 법인세 신고' },
      { date: '04-25', title: '부가가치세 예정신고', description: '1기 예정신고 및 납부' },
      { date: '05-31', title: '종합소득세 신고', description: '개인사업자 종합소득세 확정신고' },
      { date: '07-25', title: '부가가치세 확정신고', description: '1기 확정신고 및 납부' },
      { date: '10-25', title: '부가가치세 예정신고', description: '2기 예정신고 및 납부' }
    ];
  }
}

export default TaxKnowledgeSearch;